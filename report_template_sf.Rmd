---
title: "Mediation Analysis Report - Single Mediator at Fixed Time"
output: word_document
params:
  exposure: NULL
  mediator: NULL
  outcome: NULL
  basec_vars: NULL
  postc_vars: NULL
  yreg_type: NULL
  model_summary: NULL
  path_table: NULL
  dag_path: NULL
  path_plot_path: NULL
  proportion_mediated: NULL
  interpretation_text: NULL
  mreg_type: NULL
  postcreg_type: NULL
  interaction: NULL
  missing_data_method: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(knitr)
```

# 1. Objective

This analysis aimed to evaluate the extent to which the effect of `r params$exposure` on `r params$outcome` is mediated through `r params$mediator`. Specifically, we estimated the direct and indirect (mediated) effects using a counterfactual-based causal mediation approach. The results provide insight into the pathways by which the exposure impacts the outcome, and quantify the proportion of the total effect that is attributable to the mediator.

# 2. Methods
```{r,  results = 'asis', echo = FALSE}
# 2. Statistical Methodology
pm_formula <- if (tolower(params$yreg_type) == "linear") {
  "the indirect effect divided by the total effect, multiplied by 100%"
} else if (tolower(params$yreg_type) == "logistic") {
  "(Direct × (Indirect − 1)) divided by (Total effect − 1)"
} else {
  "defined according to the chosen outcome model"
}

basec_text <- if (!is.null(params$basec_vars) && length(params$basec_vars) > 0) {
  paste0("Baseline covariates ", paste(params$basec_vars, collapse = ", "), " were adjusted for.")
} else { "" }

postc_text <- if (!is.null(params$postc_vars) && length(params$postc_vars) > 0) {
  paste0("Post-treatment confounders ", paste(params$postc_vars, collapse = ", "), " were controlled for.")
} else { "" }

mediator_text <- paste0("Mediators investigated were ", params$mediator, ".")

parts <- c(
  sprintf("Mediation analyses were conducted to decompose the total effect of %s on %s into direct effect and indirect effect.", params$exposure, params$outcome),
  sprintf("The direct effect quantified the effect of %s on change in %s independent of changes in %s.", params$exposure, params$outcome, params$mediator),
  sprintf("Conversely, the indirect effect captured the effect of %s on change in %s associated with changes in %s.", params$exposure, params$outcome, params$mediator),
  "Because these comparisons involve non-observable counterfactual scenarios, natural effect models were employed to estimate the direct and indirect effects.",
  "The total effect was defined as the sum of these two components.",
  sprintf("The proportion mediated was calculated as %s, and standard errors were derived using the bootstrap method.", pm_formula),
  sprintf("The outcome was %s.", params$outcome),
  if (nzchar(basec_text)) basec_text else NULL,
  if (nzchar(postc_text)) postc_text else NULL,
  mediator_text
)

cat(paste(parts, collapse = " "))
```

# 3. Results
## 3.1 Assumed Causal Structure
The diagram below illustrates the assumed causal model used to guide variable selection and estimation of path-specific effects.
```{r, fig.align='center', out.width='100%'}
knitr::include_graphics(params$dag_path)
```

## 3.2 Path Effect Estimates
The table below summarizes the estimated path-specific effects, including standard errors, confidence intervals, and p-values:
```{r, fig.align='center', out.width='100%'}
kable(params$path_table, digits = 3, caption = "Estimated Path Effects")
```

## 3.3 Visualization of Effects
The forest plot below displays the estimated total, direct, and indirect effects with 95% confidence intervals:
```{r, fig.align='center', out.width='100%'}
knitr::include_graphics(params$path_plot_path)
```

## 3.4 Interpretations of Results
```{r, results = 'asis'}
cat(params$interpretation_text)
```


















